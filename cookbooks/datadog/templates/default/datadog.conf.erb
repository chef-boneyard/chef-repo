# Generated by Chef, local modifications will be overwritten

[Main]
dd_url: <%= @dd_url %>
api_key: <%= @api_key %>
debug_mode: <%= node['datadog']['debug'] %>
check_freq: <%= node['datadog']['check_freq'] %>
hostname: <%= node['datadog']['hostname'] %>
use_mount: <%= node['datadog']['use_mount'] ? "yes" : "no"  %>
listen_port: <%= node['datadog']['agent_port'] %>
<% if node['datadog']['autorestart'] -%>
autorestart: <%= node['datadog']['autorestart'] %>
<% end -%>
tags: <%= node['datadog']['tags'] %>
<% if node['datadog']['web_proxy']['host'] -%>
proxy_host: <%= node['datadog']['web_proxy']['host'] %>
proxy_port: <%= node['datadog']['web_proxy']['port'] %>
proxy_user: <%= node['datadog']['web_proxy']['user'] %>
proxy_password: <%= node['datadog']['web_proxy']['password'] %>
<% end -%>

<% if node['datadog']['non_local_traffic'] == true %>
non_local_traffic: true
<% end -%>

<% if !node['datadog']['dogstreams'].empty? -%>
dogstreams: <%= node['datadog']['dogstreams'].join(', ') %>
<% end -%>

<% if node['datadog']['graphite'] -%>
graphite_listen_port: <%= node['datadog']['graphite_port'] %>
<% end -%>

<% if node['datadog']['dogstatsd'] -%>
# ========================================================================== #
# DogStatsd configuration                                                    #
# ========================================================================== #

# DogStatsd is a small server that aggregates your custom app metrics. For
# usage information, check out http://docs.datadoghq.com

#  Make sure your client is sending to the same port.
dogstatsd_port: <%= node['datadog']['dogstatsd_port'] %>

## The dogstatsd flush period.
dogstatsd_interval: <%= node['datadog']['dogstatsd_interval'] %>

## If 'yes', counters and rates will be normalized to 1 second (that is divided
## by the dogstatsd_interval) before being sent to the server. Defaults to 'yes'
dogstatsd_normalize: <%= node['datadog']['dogstatsd_normalize'] %>
<% end -%>

# ========================================================================== #
# Logging
# ========================================================================== #

log_level: INFO

# collector_log_file: /var/log/datadog/collector.log
# forwarder_log_file: /var/log/datadog/forwarder.log
# dogstatsd_log_file: /var/log/datadog/dogstatsd.log
# pup_log_file:       /var/log/datadog/pup.log

# if syslog is enabled but a host and port are not set, a local domain socket
# connection will be attempted
#
log_to_syslog: <%= node['datadog']['syslog']['active'] ? 'yes' : 'no' %>
<% if node['datadog']['syslog']['udp'] -%>
syslog_host: <%= node['datadog']['syslog']['host'] %>
syslog_port: <%= node['datadog']['syslog']['port'] %>

<% end -%>
# ========================================================================== #
# Legacy Integrations
# ========================================================================== #

# For integrations which do not yet use the yaml configurations
<%
if node['datadog']['legacy_integrations']
  node['datadog']['legacy_integrations'].each do |int_name, int_hash|
    if int_hash["enabled"] and int_hash.has_key? "config"
      description = int_name
      description += " - #{int_hash["description"]}" if int_hash["description"]
      description.gsub!(/^/, '# ')
-%>
<%= description %>
<%
    ## Todo: add guardrails against other valid config directives
      int_hash['config'].each do |k,v|
-%>
<%= k %>: <%= v %>
<%
      end
    end
  end
end
-%>
